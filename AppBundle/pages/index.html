<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Home</title>
    <!--    Scripts loading  -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW"
            crossorigin="anonymous"></script>
    <!--    Links for functionnality  -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css"
          rel="stylesheet"
          integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1"
          crossorigin="anonymous">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <!--    Custom style sheets  -->
    <link rel="stylesheet" type="text/css" href="../ressources/css/main.css">
    <link rel="stylesheet" type="text/css" href="../ressources/css/index.css">
</head>
<body>
    <header>
        <div class="logo">
            <img src="../ressources/assets/images/webflix_orig.png">
        </div>
        <button class="adminSection" style="visibility: hidden">admin</button>
        <button class="profileBubble">
            <img src="../ressources/assets/images/defaultUserProfile.png"
                 alt="../ressources/assets/images/defaultUserProfile.png"
                 style="display: block;border-radius: 50%">
        </button>
    </header>
    <section id="starringShow">
        <img src="../ressources/assets/images/videoImages/wienerMobile.jpg" alt="">
    </section>
    <section id="categoryList"></section>
</body>
<script src="../ressources/javascript/mainJavaScript.js"></script>
<script>
    checkConnection();
    console.log(sessionStorage.getItem("adminAccount"));
    if (sessionStorage.getItem("adminAccount") === "1") {
        $(".adminSection").css("visibility", "visible");
    }
    $(document).ready(function(){ 
        $(window).scroll(function(){
            $('header').css("background-color", 'rgba(17, 17, 17, ' + (0.3 + (0.7 * $(window).scrollTop() / 200)) + ')');
        });
        getGenres();
        $(".profileBubble").click(function (e) {
            window.open("account/myAccount.html", "_self");
        });
        $(".right").click(function(){
            $(this).parent().parent().stop().animate({scrollLeft: "+=750"}, 800);
            return false;
        });
        $(".left").on('click', function(event) {
            $(this).parent().parent().stop().animate({scrollLeft: "-=750"}, 800);
            return false;
        });
        $(".adminSection").click(function (e) {
            window.open("admin/adminMenu.html", "_self");
        });
    });
    function getGenres(){
        let listeGenres = [];
        $.ajax({
            //Process the form using $.ajax()
            type: 'POST', //Method type
            url: '../management/getGenres.php', //Your form processing file URL
            dataType: 'JSON',
            success: function(data) {
                let currGenres;
                for(ctr = 0; ctr < data.length; ctr++){
                    currGenres = JSON.parse(data[ctr][0]);

                    for(ctrGenres = 0; ctrGenres < currGenres.length; ctrGenres++){
                        if($.inArray(currGenres[ctrGenres], listeGenres) === -1){
                            listeGenres.push(currGenres[ctrGenres]);
                        }
                    } 
                }
                getVideosByGenre(listeGenres);
            },
            error: function(erreur, message) {
                console.log(erreur, message);
            }
        });
    }
    function getVideosByGenre(listeGenres){
        for(ctr = 0; ctr < listeGenres.length; ctr++){
            let ctrAjax = ctr;
            $.ajax({
                //Process the form using $.ajax()
                type: 'POST', //Method type
                url: '../management/getVideosByGenre.php', //Your form processing file URL
                data: { 'genre': listeGenres[ctrAjax] },
                dataType: 'JSON',
                success: function(data) {
                    // header de categorie
                    $("#categoryList").append('<h4 class="catTitle">'+listeGenres[ctrAjax]+'</h4>' +
                        '<hr><div class="category" id="'+listeGenres[ctrAjax]+'""></div>');
                    // debut de la liste et fleche de gauche
                    $("#"+listeGenres[ctrAjax]).append('<ul class="videoList"><div class="left">' +
                        '<i class="material-icons md-36">arrow_back_ios</i></div></ul>');
                        // cards de la liste
                        for(ctrVid = 0; ctrVid < data.length; ctrVid++){
                            $("#"+listeGenres[ctrAjax] + "> .videoList").append(`
                                <div onclick = "Details('${data[ctrVid].File}')" class="card">
                                <img src="${data[ctrVid].Image}" class="card-img">
                                <div class="card-body">
                                <h5 class="card-title" id="card1Title">${data[ctrVid].Title}</h5>
                                <p class="card-text">${data[ctrVid].Resume}</p>
                                </div>
                                </div>`);
                        }
                    // fleche de droite et fin de la liste
                    $("#"+listeGenres[ctrAjax] + "> .videoList")
                        .append('<div class="right"><i class="material-icons md-36">arrow_forward_ios</i></div><hr>');
                },
                error: function(erreur, message) {
                    console.log(erreur, message);
                }
            });
        }
    }
    function Details(ID) {
        sessionStorage.setItem("VideoPath", ID);
        window.open("title.html", "_self");
    }
</script>
<style>
    .adminSection {
        width: 5%;
        margin: auto;
        padding: 5px 2px;
        background: transparent;
        text-align: center;
        font-weight: bold;
        text-transform: uppercase;
        transition: all 0.2s ease;
        border: 1px solid white;
    }
    .adminSection:hover {
        background: var(--accent);
        border: 1px solid var(--accent);
        transition: all 1.5s ease;
        cursor: pointer;
    }
    .adminSection:active {
        transform: scale(0.98);
    }
</style>
</html>