<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.2/css/bootstrap.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.23/css/dataTables.bootstrap4.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.23/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.23/js/dataTables.bootstrap4.min.js"></script>
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/plug-ins/1.10.22/i18n/French.json"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="../../../ressources/css/">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <meta charset="utf-8">
    <title>thing</title>
</head>

<body>
    <form id="management"><br>
        <table id="managementaccount" class="table table-striped table-bordered">
            <thead style="text-align: center;">
                <tr>
                    <th>Nom d'affichage</th>
                    <th>Courriel</th>
                    <th>Telephone</th>
                    <th>Gestion</th>
                    <th></th>
                </tr>
            </thead>
            <tbody id="bodyaccount" style="text-align: left;">
            </tbody>
        </table>
    </form>
    <br>
    <!--Modal confirmation de suppression-->
    <div class="modal" id="modalconfirmdelete" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Suppression d'un utilisateur</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p id="modalbody">Êtes-vous certain de vouloir supprimer l'utilisateur ?</p>
                </div>
                <div class="modal-footer">
                    <button id="btconfirmdelete" type="button" class="btn btn-primary">Oui</button>
                    <button id="btcanceldelete" type="button" class="btn btn-secondary" data-dismiss="modal">Non</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        $(document).ready(function() {
            function table2() {
                $('#managementaccount').DataTable({
                    "language": {
                        "emptyTable": "Aucune donnée disponible dans le tableau",
                        "lengthMenu": "Afficher _MENU_ éléments",
                        "loadingRecords": "Chargement...",
                        "processing": "Traitement...",
                        "zeroRecords": "Aucun élément correspondant trouvé",
                        "paginate": {
                            "first": "Premier",
                            "last": "Dernier",
                            "next": "Suivant",
                            "previous": "Précédent"
                        },
                        "aria": {
                            "sortAscending": ": activer pour trier la colonne par ordre croissant",
                            "sortDescending": ": activer pour trier la colonne par ordre décroissant"
                        },
                        "select": {
                            "rows": {
                                "_": "%d lignes sélectionnées",
                                "0": "Aucune ligne sélectionnée",
                                "1": "1 ligne sélectionnée"
                            },
                            "1": "1 ligne selectionnée",
                            "_": "%d lignes selectionnées",
                            "cells": {
                                "1": "1 cellule sélectionnée",
                                "_": "%d cellules sélectionnées"
                            },
                            "columns": {
                                "1": "1 colonne sélectionnée",
                                "_": "%d colonnes sélectionnées"
                            }
                        },
                        "autoFill": {
                            "cancel": "Annuler",
                            "fill": "Remplir toutes les cellules avec <i>%d<\/i>",
                            "fillHorizontal": "Remplir les cellules horizontalement",
                            "fillVertical": "Remplir les cellules verticalement",
                            "info": "Exemple de remplissage automatique"
                        },
                        "searchBuilder": {
                            "conditions": {
                                "date": {
                                    "after": "Après le",
                                    "before": "Avant le",
                                    "between": "Entre",
                                    "empty": "Vide",
                                    "equals": "Egal à",
                                    "not": "Différent de",
                                    "notBetween": "Pas entre",
                                    "notEmpty": "Non vide"
                                },
                                "moment": {
                                    "after": "Après le",
                                    "before": "Avant le",
                                    "between": "Entre",
                                    "empty": "Vide",
                                    "equals": "Egal à",
                                    "not": "Différent de",
                                    "notBetween": "Pas entre",
                                    "notEmpty": "Non vide"
                                },
                                "number": {
                                    "between": "Entre",
                                    "empty": "Vide",
                                    "equals": "Egal à",
                                    "gt": "Supérieur à",
                                    "gte": "Supérieur ou égal à",
                                    "lt": "Inférieur à",
                                    "lte": "Inférieur ou égal à",
                                    "not": "Différent de",
                                    "notBetween": "Pas entre",
                                    "notEmpty": "Non vide"
                                },
                                "string": {
                                    "contains": "Contient",
                                    "empty": "Vide",
                                    "endsWith": "Se termine par",
                                    "equals": "Egal à",
                                    "not": "Différent de",
                                    "notEmpty": "Non vide",
                                    "startsWith": "Commence par"
                                },
                                "array": {
                                    "equals": "Egal à",
                                    "empty": "Vide",
                                    "contains": "Contient",
                                    "not": "Différent de",
                                    "notEmpty": "Non vide",
                                    "without": "Sans"
                                }
                            },
                            "add": "Ajouter une condition",
                            "button": {
                                "0": "Recherche avancée",
                                "_": "Recherche avancée (%d)"
                            },
                            "clearAll": "Effacer tout",
                            "condition": "Condition",
                            "data": "Donnée",
                            "deleteTitle": "Supprimer la règle de filtrage",
                            "logicAnd": "Et",
                            "logicOr": "Ou",
                            "title": {
                                "0": "Recherche avancée",
                                "_": "Recherche avancée (%d)"
                            },
                            "value": "Valeur"
                        },
                        "searchPanes": {
                            "clearMessage": "Effacer tout",
                            "count": "{total}",
                            "title": "Filtres actifs - %d",
                            "collapse": {
                                "0": "Volet de recherche",
                                "_": "Volet de recherche (%d)"
                            },
                            "countFiltered": "{shown} ({total})",
                            "emptyPanes": "Pas de volet de recherche",
                            "loadMessage": "Chargement du volet de recherche..."
                        },
                        "buttons": {
                            "copyKeys": "Appuyer sur ctrl ou u2318 + C pour copier les données du tableau dans votre presse-papier.",
                            "collection": "Collection",
                            "colvis": "Visibilité colonnes",
                            "colvisRestore": "Rétablir visibilité",
                            "copy": "Copier",
                            "copySuccess": {
                                "1": "1 ligne copiée dans le presse-papier",
                                "_": "%ds lignes copiées dans le presse-papier"
                            },
                            "copyTitle": "Copier dans le presse-papier",
                            "csv": "CSV",
                            "excel": "Excel",
                            "pageLength": {
                                "-1": "Afficher toutes les lignes",
                                "1": "Afficher 1 ligne",
                                "_": "Afficher %d lignes"
                            },
                            "pdf": "PDF",
                            "print": "Imprimer"
                        },
                        "decimal": ",",
                        "info": "Affichage de _START_ à _END_ sur _TOTAL_ éléments",
                        "infoEmpty": "Affichage de 0 à 0 sur 0 éléments",
                        "infoFiltered": "(filtrés de _MAX_ éléments au total)",
                        "infoThousands": ".",
                        "search": "Rechercher:",
                        "searchPlaceholder": "Rechercher...",
                        "thousands": "."
                    }
                });
            }
            $.ajax({
                //Process the form using $.ajax()
                type: 'POST', //Method type
                url: '../../../AppBundle/management/getAccountForManagement.php', //Your form processing file URL
                dataType: 'JSON',
                success: function(data) {
                    console.log("ggg" + data);
                    for (ctr = 0; ctr < data['item'].length; ctr++) {
                        $("#bodyaccount").append(`
                    <tr>
                    <td>${data['item'][ctr].ScreenName}</td>
                    <td class = "Email">${data['item'][ctr].Email}</td>
                    <td style="width:175px;">${data['item'][ctr].Phone}</td>
                    <td style="text-align: center;">${data['item'][ctr].Admin.replace(0, "<input type='checkbox' class='admin'>")
                            .replace(1, "<input type='checkbox' class='admin'checked>")}</td>
                    <td style="text-align: center;"><button type="button" class="btn btn-danger delete" value = "${data['item'][ctr].Email}">Supprimer</button></td>
                    </tr>`);
                    }
                    table2();
                },
                error: function(erreur, message) {
                    console.log(erreur, message);
                }

            });
            $(document).on('click', '.delete', function(e) {
                e.preventDefault();
                let valeur = e.target.parentElement.parentElement.childNodes[3].textContent;
                sessionStorage.setItem("emaildelete", valeur);
                $('#modalconfirmdelete').modal('show');
            })
            $(document).on('click', '.admin', function(e) {
                let valeur = e.target.parentElement.parentElement.childNodes[7].firstChild.checked;
                console.log(valeur);
                let id = e.target.parentElement.parentElement.childNodes[3].textContent;
                console.log(id);
                let postForm1 = {
                    'id': id,
                    'val': valeur
                }
                $.ajax({
                    //Process the form using $.ajax()
                    type: 'POST', //Method type
                    url: '../../../AppBundle/management/updateadminaccount.php', //Your form processing file URL
                    data: postForm1, //Forms name
                    dataType: 'JSON',
                    success: function(data) {
                        console.log(data); {
                            window.open("adminMenu.html", "_self");
                        }
                    },
                    error: function(erreur, message) {
                        console.log(erreur, message);
                    }

                });
            });

            $("#btcanceldelete").click(function(e) {
                $('#modalconfirmdelete').modal('hide');
            });

            $("#btconfirmdelete").click(function() {
                $('#modalconfirmdelete').modal('hide');
                let valeur = sessionStorage.getItem("emaildelete");
                let postForm = {
                    'id': valeur
                }
                $.ajax({
                    //Process the form using $.ajax()
                    type: 'POST', //Method type
                    url: '../../../AppBundle/management/deleteaccounts.php', //Your form processing file URL
                    data: postForm, //Forms name
                    dataType: 'JSON',
                    success: function(data) {
                        console.log(data); {
                            sessionStorage.setItem("emaildelete", "");
                            window.open("adminMenu.html", "_self");
                        }
                    },
                    error: function(erreur, message) {
                        console.log(erreur, message);
                    }

                });
            });
        });
    </script>
</body>

</html>